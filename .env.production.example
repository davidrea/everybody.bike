##############################################################################
# everybody.bike — Production Environment Variables
#
# Copy to .env and fill in all values before running docker compose up.
#
# Quick start:
#   1. cp .env.production.example .env
#   2. bash scripts/generate-keys.sh    → paste Supabase secrets into .env
#   3. npx web-push generate-vapid-keys → paste VAPID keys into .env
#   4. openssl rand -hex 32             → paste as NOTIFICATION_DISPATCH_SECRET
#   5. Fill in SITE_URL, API_EXTERNAL_URL, and SMTP credentials
#   6. node scripts/verify-smtp.js      → verify SMTP before going live
#   7. docker compose build app
#   8. docker compose up -d
#   9. docker compose run --rm migrate  (first time only, applies app schema)
#  10. bash scripts/bootstrap-admin.sh --email you@example.com --name "Your Name"
#      (creates first super_admin, prints magic link + OTP to terminal)
##############################################################################


############
# URLs — Set these to your actual domain
############

# The public URL of your app (where users visit)
SITE_URL=https://everybody.bike

# The public URL of the Supabase API gateway (Kong)
# This must be reachable from user browsers for auth callbacks
API_EXTERNAL_URL=https://api.everybody.bike
API_EXTERNAL_HOSTS=api.everybody.bike,everybody.bike

# Auth redirect URLs (comma-separated, in addition to SITE_URL)
ADDITIONAL_REDIRECT_URLS=https://everybody.bike/auth/callback


############
# Secrets — CHANGE ALL OF THESE
# Run: bash scripts/generate-keys.sh
############

POSTGRES_PASSWORD=your-super-secret-and-long-postgres-password
JWT_SECRET=your-super-secret-jwt-token-with-at-least-32-characters-long
ANON_KEY=<generated-anon-jwt>
SERVICE_ROLE_KEY=<generated-service-role-jwt>
DASHBOARD_USERNAME=supabase
DASHBOARD_PASSWORD=<generated-dashboard-password>
SECRET_KEY_BASE=<generated-secret-key-base>
VAULT_ENC_KEY=<generated-vault-enc-key>
PG_META_CRYPTO_KEY=<generated-pg-meta-crypto-key>
LOGFLARE_PUBLIC_ACCESS_TOKEN=<generated-logflare-public-token>
LOGFLARE_PRIVATE_ACCESS_TOKEN=<generated-logflare-private-token>


############
# Database
############

POSTGRES_HOST=db
POSTGRES_DB=postgres
POSTGRES_PORT=5432


############
# Auth — GoTrue configuration
############

JWT_EXPIRY=3600
DISABLE_SIGNUP=false
ENABLE_EMAIL_SIGNUP=true
ENABLE_EMAIL_AUTOCONFIRM=false

# OTP / magic link expiry in seconds (default: 12 hours)
MAILER_OTP_EXP=43200


############
# SMTP — Email delivery
# Required for magic link login and invite emails
############

SMTP_ADMIN_EMAIL=admin@everybody.bike
SMTP_HOST=smtp.mailgun.org
SMTP_PORT=587
SMTP_USER=postmaster@mg.everybody.bike
SMTP_PASS=<your-mailgun-password>
SMTP_SENDER_NAME=Everybody.Bike
SMTP_FROM=Everybody.Bike <admin@everybody.bike>


############
# WebAuthn / Passkeys
# "auto" derives from request headers (recommended behind Cloudflare Tunnel)
############

WEBAUTHN_RP_ID=auto
WEBAUTHN_RP_NAME=everybody.bike
WEBAUTHN_ORIGIN=auto


############
# Web Push — VAPID keys
# Generate with: npx web-push generate-vapid-keys
############

VAPID_PUBLIC_KEY=<your-vapid-public-key>
VAPID_PRIVATE_KEY=<your-vapid-private-key>
VAPID_SUBJECT=mailto:admin@everybody.bike


############
# Notification Dispatch
# Bearer token for the cron job that triggers /api/admin/notifications/dispatch
# Generate with: openssl rand -hex 32
############

NOTIFICATION_DISPATCH_SECRET=<your-dispatch-secret>


############
# Ports — Change if you have conflicts
############

APP_PORT=3000
KONG_HTTP_PORT=8000


############
# Cloudflare Tunnel
############

CLOUDFLARE_TUNNEL_TOKEN=<your-cloudflared-token>


############
# Supavisor — Connection pooler
############

POOLER_TENANT_ID=everybody-bike
POOLER_DEFAULT_POOL_SIZE=20
POOLER_MAX_CLIENT_CONN=100
POOLER_DB_POOL_SIZE=5


############
# PostgREST
############

PGRST_DB_SCHEMAS=public,storage,graphql_public


############
# Studio
############

STUDIO_DEFAULT_ORGANIZATION=everybody.bike
STUDIO_DEFAULT_PROJECT=everybody-bike


############
# Misc
############

IMGPROXY_ENABLE_WEBP_DETECTION=true
DOCKER_SOCKET_LOCATION=/var/run/docker.sock
